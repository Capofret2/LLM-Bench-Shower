<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LLM Bench Shower</title>
  <script>
    // 前端与后端分离时，设置后端地址；可在控制台执行：
    // localStorage.setItem('lbs_api_base', 'http://127.0.0.1:5000');
    window.API_BASE =
      window.localStorage.getItem("lbs_api_base") || "http://127.0.0.1:5000";
    
    // Log API base for debugging
    console.log('[Frontend] API_BASE configured as:', window.API_BASE);
    console.log('[Frontend] Current page origin:', window.location.origin);
  </script>
  <link rel="stylesheet" href="./css/styles.css" />
  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <h1>LLM Bench Shower</h1>
    <p>选择本地模型，挑选数据集，一键跑测评并查看结果。</p>
  </header>

  <main>
    <section class="card">
      <h2>配置</h2>
      <form id="bench-form">
        <label class="field">
          <span>模型存储文件夹路径</span>
          <div style="display: flex; gap: 8px;">
            <input id="model-folder-path" type="text" value="/root/autodl-tmp/models" placeholder="例如：/models 或 /root/models" style="flex: 1;" />
            <button id="scan-models-btn" type="button">扫描模型</button>
          </div>
          <small>输入包含模型文件夹的根目录路径，系统会递归扫描多层子目录查找模型</small>
        </label>

        <label class="field">
          <span>选择模型</span>
          <select id="model-select" required>
            <option value="">请先扫描模型文件夹</option>
          </select>
          <small>扫描模型文件夹后，将显示可用的模型列表</small>
        </label>

        <label class="field">
          <span>选择数据集（可多选）</span>
          <select id="dataset-select" multiple size="8"></select>
          <small>单子数据集直接显示名称，多子数据集显示：父数据集 / 子数据集</small>
        </label>

        <div class="actions">
          <button id="run-btn" type="submit">开始测评</button>
          <button id="reset-btn" type="button">重置</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>进度</h2>
      <div id="status-box" class="status-box">等待开始…</div>
      <ul id="pending-list" class="status-list"></ul>
    </section>

    <section class="card">
      <h2>结果</h2>
      <div id="results"></div>
    </section>

    <section class="card full-width">
      <h2>正确率可视化</h2>
      <p style="color: #6b7280; font-size: 14px; margin-bottom: 16px;">
        以下图表展示各数据集在不同模型上的正确率表现。每当新模型完成测试，图表会自动更新。
      </p>
      <div id="accuracy-charts-container"></div>
    </section>
  </main>

  <script src="./js/app.js"></script>
</body>
</html>
